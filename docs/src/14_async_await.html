<!DOCTYPE html>

<html>
<head>
  <title>14_async_await.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="01_variables.html">
                  ./src/01_variables.js
                </a>
              
                
                <a class="source" href="01_variables.test.html">
                  ./src/01_variables.test.js
                </a>
              
                
                <a class="source" href="03_objects.html">
                  ./src/03_objects.js
                </a>
              
                
                <a class="source" href="03_objects.test.html">
                  ./src/03_objects.test.js
                </a>
              
                
                <a class="source" href="03_types.test.html">
                  ./src/03_types.test.js
                </a>
              
                
                <a class="source" href="04_object_prototypes.test.html">
                  ./src/04_object_prototypes.test.js
                </a>
              
                
                <a class="source" href="05_classes.test.html">
                  ./src/05_classes.test.js
                </a>
              
                
                <a class="source" href="07_functions.html">
                  ./src/07_functions.js
                </a>
              
                
                <a class="source" href="07_functions.test.html">
                  ./src/07_functions.test.js
                </a>
              
                
                <a class="source" href="08_callback.exercise_01.html">
                  ./src/08_callback.exercise_01.js
                </a>
              
                
                <a class="source" href="08_callback.html">
                  ./src/08_callback.js
                </a>
              
                
                <a class="source" href="08_callback.test.html">
                  ./src/08_callback.test.js
                </a>
              
                
                <a class="source" href="09_pass_by.html">
                  ./src/09_pass_by.js
                </a>
              
                
                <a class="source" href="10_closure_and_scoping.test.html">
                  ./src/10_closure_and_scoping.test.js
                </a>
              
                
                <a class="source" href="11_this.alerternative.html">
                  ./src/11_this.alerternative.js
                </a>
              
                
                <a class="source" href="11_this.test.html">
                  ./src/11_this.test.js
                </a>
              
                
                <a class="source" href="11a_this.html">
                  ./src/11a_this.js
                </a>
              
                
                <a class="source" href="11b_this.html">
                  ./src/11b_this.js
                </a>
              
                
                <a class="source" href="12_exercise.html">
                  ./src/12_exercise.js
                </a>
              
                
                <a class="source" href="12_exercise.test.html">
                  ./src/12_exercise.test.js
                </a>
              
                
                <a class="source" href="12_goodies.html">
                  ./src/12_goodies.js
                </a>
              
                
                <a class="source" href="13_promises.test.html">
                  ./src/13_promises.test.js
                </a>
              
                
                <a class="source" href="14_async_await.html">
                  ./src/14_async_await.js
                </a>
              
                
                <a class="source" href="14_async_await.test.html">
                  ./src/14_async_await.test.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>14_async_await.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="generator">GENERATOR</h2>
<p>a new type of function that does not behave with the run-to-completion behaviour</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> x = <span class="hljs-number">1</span>;

  <span class="hljs-keyword">yield</span>;

  <span class="hljs-keyword">return</span> x;
}

<span class="hljs-keyword">const</span> g = foo();

<span class="hljs-keyword">let</span> n = g.next();
<span class="hljs-built_in">console</span>.log(n); <span class="hljs-comment">// { value: undefined, done: false }</span>

n = g.next();
<span class="hljs-built_in">console</span>.log(n); <span class="hljs-comment">// { value: 1, done: true }</span>

<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">bar</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> x = <span class="hljs-number">14</span>;

  <span class="hljs-keyword">let</span> y = (<span class="hljs-keyword">yield</span>) * x;

  <span class="hljs-keyword">return</span> y;
}

<span class="hljs-keyword">const</span> g1 = bar();

<span class="hljs-keyword">let</span> n1 = g1.next();
<span class="hljs-built_in">console</span>.log(n1); <span class="hljs-comment">// { value: undefined, done: false }</span>

n1 = g1.next(<span class="hljs-number">3</span>);
<span class="hljs-built_in">console</span>.log(n1); <span class="hljs-comment">// { value: 42, done: true }</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="generator-promises">GENERATOR + PROMISES</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/* the iterator should listen for the promise to resolve (or reject)

then either resume the generator with the
fulfilment message

or throw an error into the generator with the rejection reason) */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">getTotal</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">yield</span> loadUserInfo();
    <span class="hljs-keyword">const</span> cartItems = <span class="hljs-keyword">yield</span> loadCartItems();
    <span class="hljs-keyword">const</span> exr = <span class="hljs-keyword">yield</span> retrieveExchangeRates();
    total = calculateTotal(userInfo, cartItems, exr);
  } <span class="hljs-keyword">catch</span> (error) {}

  <span class="hljs-keyword">return</span> total;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="async-await">ASYNC/AWAIT</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> makeRequestP1 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
  getJSON().then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(data);
    <span class="hljs-keyword">return</span> <span class="hljs-string">'done'</span>;
  });

<span class="hljs-keyword">const</span> makeRequestA1 = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">await</span> getJSON());
  <span class="hljs-keyword">return</span> <span class="hljs-string">'done'</span>;
};

<span class="hljs-comment">/*
1 - Our function has the keyword async before it.
The await keyword can only be used inside functions defined with async.
 Any async function returns a promise implicitly, and the resolve value of the promise will be whatever you return from the function (which is the string "done" in our case).

 await getJSON() means that the console.log call will wait until getJSON() promise resolves and print it value.
*/</span>

<span class="hljs-keyword">const</span> makeRequestP2 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> getJSON().then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (data.needsAnotherRequest) {
      <span class="hljs-keyword">return</span> makeAnotherRequest(data).then(<span class="hljs-function"><span class="hljs-params">moreData</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(moreData);
        <span class="hljs-keyword">return</span> moreData;
      });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">console</span>.log(data);
      <span class="hljs-keyword">return</span> data;
    }
  });
};

<span class="hljs-keyword">const</span> makeRequestA2 = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> getJSON();
  <span class="hljs-keyword">if</span> (data.needsAnotherRequest) {
    <span class="hljs-keyword">const</span> moreData = <span class="hljs-keyword">await</span> makeAnotherRequest(data);
    <span class="hljs-built_in">console</span>.log(moreData);
    <span class="hljs-keyword">return</span> moreData;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">console</span>.log(data);
    <span class="hljs-keyword">return</span> data;
  }
};

<span class="hljs-comment">/*
You have probably found yourself in a situation where you call a promise1 and then use what it returns to call promise2,
then use the results of both promises to call a promise3.
Your code most likely looked like this
*/</span>
<span class="hljs-keyword">const</span> makeRequestP3 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> promise1().then(<span class="hljs-function"><span class="hljs-params">value1</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>do something</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> promise2(value1).then(<span class="hljs-function"><span class="hljs-params">value2</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>do something</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> promise3(value1, value2);
    });
  });
};

<span class="hljs-keyword">const</span> makeRequestA3 = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> value1 = <span class="hljs-keyword">await</span> promise1();
  <span class="hljs-keyword">const</span> value2 = <span class="hljs-keyword">await</span> promise2(value1);
  <span class="hljs-keyword">return</span> promise3(value1, value2);
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
